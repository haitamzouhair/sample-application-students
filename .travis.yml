language: java
jdk: oraclejdk8


# Define the services to use
services:
  - docker

before_install:
  - sudo service mysql stop
  - docker pull takimatraining/devops-training-db
  - docker run -d -p 127.0.0.1:3306:3306 takimatraining/devops-training-db

# Run Unit Test and Integration Tests
script:
  - mvn verify

# Cache the .m2 folder to prevent redownloading dependencies on each build
cache:
  directories:
  - "$HOME/.m2/repository"

env:
  global:
    -secure: "JhNWBwdKKNwvQELpGMTtj5ghKqZQ2jYgO3/c7KclpOAtVhuKiuovMmFLWjrMB8Bs8+Y0axJ5/e0/kUn4OZurn0O7MFPqZrZgCKrCNVLn09DT4k9Ewlz0EyU1vfN2jGGfCSFO/cbjH8peICyFqb98EaXEQK1YOpL+wdGvsdUYdksuYqFHrDoA3V+t11e5csAtznE+B0/wAeThAJ8Su2BIp50lg1mx4LkHxTa0UAAzNo8f4A3fGc6Rm1CGQjlZgV+4Za3qZwKRjTolmf/LA5vqUXgn5cD8Rq1gSNSyyqT9RkBuwCwSMTA8FuPmEoDew/g5w48vsdWgpScJbZZRaBFQqhQc6TdXC4q37u8DJ7BtWnROGsfV94sV9rT6CeqJpHNbWzp9D+durtTuOv8d0uvoX4JWPQvn64BscjJaIkIBxt66q4XemBtl0OlMigClP+RILHyMWqSzKJpiCq//DLRkup0RbDjPkD4d/L9EpTNCji9Vm3kTZpFCO3kaiDi23R4NyjfZYR7VN5jG3H1vjTNvkkXulY8m7PPXtdZvX/zybg0/b15i3kJGkzA7ri114g2sGUKtoYEbWzTjQhwUlksV2R4BGWA1wxu7teEYGAhhtYO6EAtC3i9cj41IV6laOFPMBZvAiHlvRQMHxvM0RZYSP11HDkMLPLpl4dZsqb9L/RI="


script:
 - |
    mvn clean install sonar:sonar \
    -Dsonar.projectKey=haitamzouhair_sample-application-students \
    -Dsonar.organization=haitamzouhair-github \
    -Dsonar.host.url=https://sonarcloud.io \
    -Dsonar.login=$SONAR_TOKEN
